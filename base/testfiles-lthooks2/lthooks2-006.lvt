% Testing adding and removing code from hooks in different orders

\ExplSyntaxOn
\debug_on:n { check-declarations , deprecation }
\ExplSyntaxOff

\documentclass{article}
\input{regression-test}


\ExplSyntaxOn
\cs_new_protected:Npn \DebugPrintHookMsg #1
  {
    \iow_term:n {-------------------}
    \iow_term:n {#1}
    \DebugPrintHook
  }
\ExplSyntaxOff

\START

\NewHook{some-hook-a}

% Normal order; add code, then remove from an existing hook:
\AddToHook{some-hook-a}[my-package]{CODE}
\DebugPrintHookMsg{my-package added CODE:}{some-hook-a}
\DeclareHookRule{some-hook-a}{my-package}{after}{another-package}
\DebugPrintHookMsg{Adding a rule:}{some-hook-a}
\RemoveFromHook{some-hook-a}[my-package]
\DebugPrintHookMsg{Now there are no code chunks:}{some-hook-a}

% Normal order: add code, then remove from an undeclared hook:
\AddToHook{some-hook-b}[my-package]{CODE}
\DebugPrintHookMsg{my-package added CODE:}{some-hook-b}
\DeclareHookRule{some-hook-b}{my-package}{after}{another-package}
\DebugPrintHookMsg{Adding a rule:}{some-hook-a}
\RemoveFromHook{some-hook-b}[my-package]
\DebugPrintHookMsg{Now there are no code chunks:}{some-hook-b}

% Reversed order; remove code, then try to add to an existing hook:
\RemoveFromHook{some-hook-a}[my-package]
\DebugPrintHookMsg{No code:}{some-hook-a}
\DeclareHookRule{some-hook-a}{my-package}{after}{another-package}
\DebugPrintHookMsg{Adding a rule:}{some-hook-a}
\AddToHook{some-hook-a}[my-package]{CODE}
\DebugPrintHookMsg{Still no code:}{some-hook-a}

% Reversed order: remove code, then try to add to an undeclared hook:
\RemoveFromHook{some-hook-b}[my-package]
\DebugPrintHookMsg{No code:}{some-hook-b}
\DeclareHookRule{some-hook-b}{my-package}{after}{another-package}
\DebugPrintHookMsg{Adding a rule:}{some-hook-a}
\AddToHook{some-hook-b}[my-package]{CODE}
\DebugPrintHookMsg{Still no code:}{some-hook-b}

\END
