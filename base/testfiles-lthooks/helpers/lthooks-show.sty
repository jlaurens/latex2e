% This is a library of commands used by various `lthooks*.lvt`

\IncludeInRelease{2020-10-01}{\TESTBlockHook}{Message}

\def\DebugShowHookEnv#1{
  \ShowHook{env/#1/before}
  \ShowHook{env/#1/begin}
  \ShowHook{env/#1/end}
  \ShowHook{env/#1/after}
}

\def\DebugShowHookCmd#1{
  \ShowHook{cmd/#1/before}
  \ShowHook{cmd/#1/after}
}

\def\TESTBlockHookEnv#1#2{
% run at the top level
% #1: the title of the block
% #2: the name of the environment
  \BEGINTEST{Environment: #2}
    \DebugShowHookEnv{#2}
    \AddToHook{env/#2/before}{\TYPE{<#2 BEFORE>}}
    \AddToHook{env/#2/begin}{\TYPE{<#2 BEGIN>}}
    \AddToHook{env/#2/end}{\TYPE{<#2 END>}}
    \AddToHook{env/#2/after}{\TYPE{<#2 AFTER>}}
    \DebugShowHookEnv{#2}
  \ENDTEST
}

\def\TESTBlockHookCmd#1#2{
% run at the top level
% #1: the title of the block
% #2: the csname of the command
  \BEGINTEST{Command: #1}
    \DebugShowHookCmd{#2}
    \AddToHook{cmd/#2/before}{\TYPE{<#2 BEFORE>}}
    \AddToHook{cmd/#2/after}{\TYPE{<#2 AFTER>}}
    \DebugShowHookCmd{#2}
  \ENDTEST
}
\def\TESTBlockHookCustomGeneric#1#2{
% run at the top level
% #1: the title of the block
% #2: the name of the hook
  \BEGINTEST{Custom generic hook: #1}
    \def\TEST{
      \UseHook{#2}
      \ShowHook{#2}
    }
    \BEGINTEST{Raw: #2}
      \AddToHook{#2}[LABEL]{\TYPE{<#2 CODE>}}
      \TEST
    \ENDTEST
    \BEGINTEST{Activated: #2}
      \ActivateGenericHook{#2}
      \TEST
    \ENDTEST
    \BEGINTEST{Disabled: #2}
      \DisableGenericHook{#2}
      \TEST
    \ENDTEST
  \ENDTEST
}
\def\TESTBlockHook#1#2{
% run at the top level
% #1: the title of the block
% #2: the name of the hook
  \BEGINTEST{#1}
    \def\TEST{
      \UseHook{#2}
      \ShowHook{#2}
    }
    \BEGINTEST{Undeclared #2}
    \TEST
    \ENDTEST
    \BEGINTEST{#2 + TOP LEVEL}
      \AddToHook{#2}{\TYPE{<#2 TOP-LEVEL>}}
      \TEST
    \ENDTEST
    \BEGINTEST{#2 + A LABEL}
      \AddToHook{#2}[A LABEL]{\TYPE{<#2 A CODE>}}
      \TEST
    \ENDTEST
    \BEGINTEST{#2 + B LABEL}
      \AddToHook{#2}[B LABEL]{\TYPE{<#2 B CODE>}}
      \TEST
    \ENDTEST
    \BEGINTEST{#2 + C LABEL}
      \AddToHook{#2}[C LABEL]{\TYPE{<#2 C CODE>}}
      \TEST
    \ENDTEST
    \BEGINTEST{#2 + NEXT}
      \AddToHookNext{#2}{\TYPE{<NEXT-ONLY>}}
      \ShowHook{#2}
      \TEST
    \ENDTEST
    \BEGINTEST{#2 + C LABEL < A LABEL}
      \DeclareHookRule{#2}{C LABEL}{before}{A LABEL}
      \TEST
    \ENDTEST
    \BEGINTEST{#2 + DEFAULT: B LABEL > C LABEL}
      \DeclareDefaultHookRule{B LABEL}{after}{C LABEL}
      \TEST
    \ENDTEST
  \ENDTEST
}
\EndIncludeInRelease%{2020-10-01}{\TESTBlockHookOneArg}{Message}

\IncludeInRelease{0000-00-00}{\whatever}{Message}
\EndIncludeInRelease
