% for getting the examples in the code really ...

\ExplSyntaxOn
\debug_on:n { check-declarations , deprecation }
\ExplSyntaxOff

\documentclass{article}

\input{regression-test}

\START

\BEGINTEST{Builtin generic}

\ASSERTMatchDebugPrintHook{generic:\ Y}{cmd/foo/before}

\ENDTEST

\BEGINTEST{Activated generic}

\ActivateGenericHook{babel/esperanto/afterextras}
\ASSERTMatchDebugPrintHook{generic:\ N}{babel/esperanto/afterextras}

\ENDTEST

\NewDocumentCommand\FOO{}{\typeout{FOO}}
\FOO
\AddToHook{cmd/FOO/before}{\TYPE{<<<}}
\AddToHook{cmd/FOO/after}{\TYPE{>>>}}

\SEPARATOR
\TYPE{begin{document}}
\SEPARATOR
\OMIT
\begin{document}
\TIMO
\BEGINTEST{Unsupported `/` in builtin generic name variable part}

\NewDocumentEnvironment{lthooks/TEST}{}{}{}
\AddToHook{env/lthooks/TEST/before}{\TYPE{FAILED~(BEFORE)}}
\AddToHook{env/lthooks/TEST/begin}{\TYPE{FAILED~(BEGIN)}}
\AddToHook{env/lthooks/TEST/end}{\TYPE{FAILED~(END)}}
\AddToHook{env/lthooks/TEST/after}{\TYPE{FAILED~(AFTER)}}
\begin{lthooks/TEST}\TYPE{PASSED}\end{lthooks/TEST}

\ENDTEST

\BEGINTEST{Simulate environment `lthooks/TEST0`}

\ExplSyntaxOn

\NewDocumentEnvironment{lthooks/TEST0}{}
  {\UseHook{env/lthooks/TEST0/before}\group_begin:\UseHook{env/lthooks/TEST0/before}}
  {\UseHook{env/lthooks/TEST0/after}\group_end:\UseHook{env/lthooks/TEST0/after}}
\NewHook{env/lthooks/TEST0/before}
\NewHook{env/lthooks/TEST0/begin}
\NewHook{env/lthooks/TEST0/end}
\NewReversedHook{env/lthooks/TEST0/after}

\cs_set:Npn \TESTER #1 {
  \group_begin:
  \cs_set:Npn \TESTER { \TYPE{FAILED~(#1)} }
  \AddToHook{env/lthooks/TEST0/#1}{ \cs_set:Npn \TESTER { \TYPE{PASSED~(#1)} } }
  \begin{lthooks/TEST0}\TYPE{PASSED~(body)}\end{lthooks/TEST0}
  \TESTER
  \group_end:
}
\ExplSyntaxOff

\TESTER{before}
\TESTER{begin}
\TESTER{end}
\TESTER{after}

\ENDTEST

\BEGINTEST{cmd/TESTFOO/...}
\ExplSyntaxOn
\cs_undefine:N \TESTFOO
\NewDocumentCommand\TESTFOO{}{\TYPE{PASSED~(TESTFOO)}}
\TESTFOO
\AddToHook
  {cmd/TESTFOO/before}
  [A]
  {\cs_set:Npn \TESTFOOBEFORE{\TYPE{FAILED~(before)}}}
\AddToHook
  {cmd/TESTFOO/before}
  [B]
  {\cs_set:Npn \TESTFOOBEFORE{\TYPE{PASSED~(before)}}}
\AddToHook
  {cmd/TESTFOO/after}
  [A]
  {\cs_set:Npn \TESTFOOAFTER{\TYPE{PASSED~(after)}}}
\AddToHook
  {cmd/TESTFOO/after}
  [B]
  {\cs_set:Npn \TESTFOOAFTER{\TYPE{FAILED~(after)}}}

%\UseHook{cmd/TESTFOO/before}
\TESTFOO
\TESTFOOBEFORE
\TESTFOOAFTER

\ExplSyntaxOff

\ENDTEST

\BEGINTEST{file/<name>/...}

\begin{filecontents}[overwrite]{lthooks-generic-A.tex}
\typeout{PASSED (lthooks-generic-A.tex)}
\end{filecontents}

\def\TESTFOOBEFORE{FAILED}
\def\TESTFOOAFTER{FAILED}

\AddToHook{file/lthooks-generic-A.tex/before}[A]
  {\def\TESTFOOBEFORE{\TYPE{FAILED (before)}}}
\AddToHook{file/lthooks-generic-A.tex/before}[B]
  {\def\TESTFOOBEFORE{\TYPE{PASSED (before)}}}
\AddToHook{file/lthooks-generic-A.tex/after}[A]
  {\def\TESTFOOAFTER{\TYPE{PASSED (after)}}}
\AddToHook{file/lthooks-generic-A.tex/after}[B]
  {\def\TESTFOOAFTER{\TYPE{FAILED (after)}}}
\DebugPrintHook{file/lthooks-generic-A.tex/before}
\DebugPrintHook{file/lthooks-generic-A.tex/after}
\input{lthooks-generic-A.tex}

\TESTFOOBEFORE
\TESTFOOAFTER

\def\TESTFOOBEFORE{FAILED}
\def\TESTFOOAFTER{FAILED}
\include{lthooks-generic-A.tex}
\TESTFOOBEFORE
\TESTFOOAFTER

\ENDTEST

\BEGINTEST{file/<name>/...}

\ENDTEST

\typeout{!!!! If this test changes the documentation needs updating !!!!}

\end{document}

\END
