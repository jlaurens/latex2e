
\ExplSyntaxOn
\debug_on:n { check-declarations , deprecation }
\ExplSyntaxOff

\documentclass{article}

\input{regression-test}

\START


\NewReversedHook{yyy}

\BEGINTEST{activate-error}
\DisableGenericHook{yyy}
\ENDTEST

\BEGINTEST{activate-disabled}
\ActivateGenericHook{yyy}
\ENDTEST

\BEGINTEST{hook-disabled}
\AddToHook{yyy}{error}
\ENDTEST

\BEGINTEST{empty-label}
\AddToHook{yyy}[]{error}
\ENDTEST

\BEGINTEST{no-default-label}
\PushHookCurrentName{}
\ENDTEST

\BEGINTEST{Rules}

\AddToHook{xxx}[label1]{ foo1}
\AddToHook{xxx}[label2]{ foo2}
\AddToHook{xxx}[label3]{ foo2}
\AddToHook{xxx}[label4]{ foo3}
\AddToHook{xxx}[label5]{ foo5}

\BEGINTEST{Error: unknown-rule}
\DeclareHookRule {xxx} {label1} {unknown} {label2}
\ENDTEST

\BEGINTEST{Warning: labels-incompatible}
\DeclareHookRule {xxx} {label3} {incompatible-warning} {label4}
\ENDTEST

\BEGINTEST{Error: labels-incompatible}
\DeclareHookRule {xxx} {label1} {incompatible-error} {label5}
\ENDTEST

\DebugPrintHook{xxx}

\ENDTEST


\makeatletter
\@expl@@@filehook@file@pop@@

\BEGINTEST{Error: set-top-level}
\SetHookCurrentName{my-document}
\ENDTEST

\AddToHook{begindocument}[top-level]{\TIMO\typeout{allowed}\OMIT}
\BEGINTEST{top-level not allowed with other labels}
\PushHookCurrentName{my-document}
\BEGINTEST{Error: misused-top-level}
  \AddToHook{begindocument}[top-level]{not allowed}
\ENDTEST
\BEGINTEST{Error: set-top-level}
  \SetHookCurrentName{top-level}
\ENDTEST
\PopHookCurrentName
\ENDTEST

\BEGINTEST{Error type: extra-pop-label}
\PopHookCurrentName
\ENDTEST

\BEGINTEST{Error type: missing-pop-label (Checked at \end{document})}
\PushHookCurrentName{error}
\PushHookCurrentName{should}
\PushHookCurrentName{this}
\ENDTEST

\OMIT
\begin{document}
\TIMO

\end{document}
